<div class="modal-overlay" *ngIf="isVisible">
  <div class="modal-content">
    <div class="modal-header">
      <h5 class="modal-title">{{ mode === 'create' ? 'Thêm sản phẩm mới' : 'Chỉnh sửa sản phẩm' }}</h5>
      <button type="button" class="close-btn" (click)="onClose()">
        <i class="fas fa-times"></i>
      </button>
    </div>
      <div class="modal-body">
        <!-- Error Message -->
        <div *ngIf="error" class="error-message">
          <i class="fas fa-exclamation-circle"></i>
          {{ error }}
        </div>

        <!-- Form -->
        <form [formGroup]="productForm" (ngSubmit)="onSubmit()">
          <div class="form-group">
            <label for="name">Tên sản phẩm <span class="required">*</span></label>
            <input 
              type="text" 
              id="name" 
              formControlName="name" 
              class="form-control" 
              [class.is-invalid]="productForm.get('name')?.invalid && productForm.get('name')?.touched"
            >
            <div *ngIf="productForm.get('name')?.invalid && productForm.get('name')?.touched" class="invalid-feedback">
              Vui lòng nhập tên sản phẩm
            </div>
          </div>

          <div class="form-group">
            <label for="description">Mô tả <span class="required">*</span></label>
            <textarea 
              id="description" 
              formControlName="description" 
              class="form-control" 
              rows="3"
              [class.is-invalid]="productForm.get('description')?.invalid && productForm.get('description')?.touched"
            ></textarea>
            <div *ngIf="productForm.get('description')?.invalid && productForm.get('description')?.touched" class="invalid-feedback">
              Vui lòng nhập mô tả sản phẩm
            </div>
          </div>

          <div class="form-row">
            <div class="form-group col-md-6">
              <label for="price">Giá <span class="required">*</span></label>
              <input 
                type="number" 
                id="price" 
                formControlName="price" 
                class="form-control"
                [class.is-invalid]="productForm.get('price')?.invalid && productForm.get('price')?.touched"
              >
              <div *ngIf="productForm.get('price')?.invalid && productForm.get('price')?.touched" class="invalid-feedback">
                Giá phải lớn hơn hoặc bằng 0
              </div>
            </div>

            <div class="form-group col-md-6">
              <label for="discountPrice">Giá khuyến mãi</label>
              <input 
                type="number" 
                id="discountPrice" 
                formControlName="discountPrice" 
                class="form-control"
                [class.is-invalid]="productForm.get('discountPrice')?.invalid && productForm.get('discountPrice')?.touched"
              >
              <div *ngIf="productForm.get('discountPrice')?.invalid && productForm.get('discountPrice')?.touched" class="invalid-feedback">
                Giá khuyến mãi phải lớn hơn hoặc bằng 0
              </div>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group col-md-6">
              <label for="categoryId">Danh mục <span class="required">*</span></label>
              <select 
                id="categoryId" 
                formControlName="categoryId" 
                class="form-control"
                [class.is-invalid]="productForm.get('categoryId')?.invalid && productForm.get('categoryId')?.touched"
              >
                <option value="">Chọn danh mục</option>
                <option *ngFor="let category of categories" [value]="category.id">{{ category.name }}</option>
              </select>
              <div *ngIf="productForm.get('categoryId')?.invalid && productForm.get('categoryId')?.touched" class="invalid-feedback">
                Vui lòng chọn danh mục
              </div>
            </div>

            <div class="form-group col-md-6">
              <label for="quantityInStock">Số lượng tồn kho <span class="required">*</span></label>
              <input 
                type="number" 
                id="quantityInStock" 
                formControlName="quantityInStock" 
                class="form-control"
                [class.is-invalid]="productForm.get('quantityInStock')?.invalid && productForm.get('quantityInStock')?.touched"
              >
              <div *ngIf="productForm.get('quantityInStock')?.invalid && productForm.get('quantityInStock')?.touched" class="invalid-feedback">
                Số lượng tồn kho phải lớn hơn hoặc bằng 0
              </div>
            </div>
          </div>

          <div class="form-row checkbox-group">
            <div class="form-check col-md-6">
              <input type="checkbox" id="isActive" formControlName="isActive" class="form-check-input">
              <label class="form-check-label" for="isActive">Kích hoạt</label>
            </div>

            <div class="form-check col-md-6">
              <input type="checkbox" id="isNew" formControlName="isNew" class="form-check-input">
              <label class="form-check-label" for="isNew">Sản phẩm mới</label>
            </div>

            <div class="form-check col-md-6">
              <input type="checkbox" id="isOnSale" formControlName="isOnSale" class="form-check-input">
              <label class="form-check-label" for="isOnSale">Đang khuyến mãi</label>
            </div>

            <div class="form-check col-md-6">
              <input type="checkbox" id="isFeatured" formControlName="isFeatured" class="form-check-input">
              <label class="form-check-label" for="isFeatured">Sản phẩm nổi bật</label>
            </div>
          </div>

          <div class="form-group">
            <label for="images">Hình ảnh sản phẩm</label>
            <input 
              type="file" 
              id="images" 
              class="form-control-file" 
              (change)="onImagesSelected($event)"
              multiple
              accept="image/*"
            >
          </div>

          <!-- Image Previews -->
          <div class="image-preview-container" *ngIf="imagePreviewUrls.length > 0">
            <div class="image-preview-item" *ngFor="let url of imagePreviewUrls; let i = index">
              <img [src]="url" alt="Preview">
              <button type="button" class="remove-image-btn" (click)="removeImage(i)">
                <i class="fas fa-times"></i>
              </button>
            </div>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn btn-outline-secondary" (click)="onClose()">Hủy</button>
            <button 
              type="submit" 
              class="btn btn-primary" 
              [disabled]="productForm.invalid || loading"
            >
              <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
              {{ mode === 'create' ? 'Thêm sản phẩm' : 'Cập nhật' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>